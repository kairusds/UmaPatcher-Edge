name: Create Android Release

permissions:
  contents: write

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, '[ci skip]')"
    steps:
    - uses: actions/checkout@v5

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        distribution: "temurin"
        java-version: 17

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v3

    - name: Build with Gradle
      run: ./gradlew build

    - name: Set app version env var
      run: |
        VERSION_NAME=$(grep -oP 'versionName\s*"\K[^"]+' app/build.gradle)
        echo "VERSION_NAME=$VERSION_NAME" >> $GITHUB_ENV

    - name: Upload binaries to a release
      uses: softprops/action-gh-release@v2
      with:
        generate_release_notes: true
        files: app/build/outputs/apk/release/*.apk
        tag_name: "v${{ env.VERSION_NAME }}"
